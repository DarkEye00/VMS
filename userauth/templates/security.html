{% extends "base.html" %}{% block content %}
<section>
   
    <div class="flex min-h-screen">
        <aside class="bg-gray-900 text-white w-64 p-6 space-y-6">
          <h1 class="text-2xl font-bold">SECURITY PERSONNEL</h1>
          <nav class="space-y-4">
            <a href="{% url 'userauth:profile' %}" class="block w-full text-left px-4 py-2 bg-gray-800 rounded hover:bg-gray-700">Profile</a>
            <button class="block w-full text-left px-4 py-2 bg-gray-800 rounded hover:bg-gray-700">Shift Logs</button>
            <button class="block w-full text-left px-4 py-2 bg-red-700 rounded hover:bg-red-600">Emergency Mode</button>
            <a href="{% url 'userauth:logout' %}" class="block w-full text-left px-4 py-2 bg-gray-800 rounded hover:bg-gray-700">Log Out</a>
          </nav>
        </aside>
    
        <!-- Main Content -->
        <main class="flex-1 p-8 space-y-8">
            {% if messages %} {% for message in messages %}

            <div
              id="notify"
              class="w-[90%] h-8 flex items-center my-2 ml-2 p-5 rounded-md bg-cyan-500/40 border-[1px] border-gray-700/40 {{message.tags}}"
            >
              {{message}}
            </div>
      
            {% endfor %} {% endif %}
          <!-- Visitor Check-In -->
          <section class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Visitor Check-In</h2>
            <form class="grid grid-cols-1 md:grid-cols-2 gap-4" method="POST" action="{% url 'userauth:security' %}">
                {% csrf_token %}
               <!-- Name -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                <input type="text" name="name" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" title="Enter your full name" placeholder="Full Name" />
            </div>
        
            <!-- Phone -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                <input type="text" name="phone" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" title="Enter your phone number" placeholder="Phone Number" />
            </div>

  <!-- Reason -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Reason for Visit</label>
                <textarea type="text" name="reason" required class="w-full h-[100px] px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" cols="50" title="Enter the reason for your visit" placeholder="Reason for visit" ></textarea>
            </div>

  <!-- Host -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Host</label>
                <select name="host" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" title="Select a host">
                    <option value="">-- Select Host --</option>
                    {% for host in hosts %}
                      <option value="{{ host.username }}">{{ host.get_full_name|default:host.username }}</option>
                    {% endfor %}
                </select>
            </div>

  <!-- Check-in Time -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Check-In Time</label>
                <input type="datetime-local" name="check_in" value="{{ now|date:'Y-m-d\\TH:i' }}" class="w-full px-4 py-2 border border-gray-300 rounded-md" title="Select check-in time" placeholder="Select check-in time" />
            </div>
            

              <button type="submit" class="bg-gray-800 text-white px-4 py-2 rounded col-span-2 cursor-pointer">Add Visitor</button>
            </form>
          </section>
    
          <!-- Visitor Check-Out -->
          <section class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Visitor Check-Out</h2>
            {% if visitors_in %}
            <div>
            <table class="w-full text-left border">
              <thead>
                <tr class="bg-gray-100">
                  <th class="p-2 border">Name</th>
                  <th class="p-2 border">Visitor ID</th>
                  <th class="p-2 border">Host</th>
                  <th class="p-2 border">Reason</th>
                  <th class="p-2 border">Checkin Time</th>
                  
                  <th class="p-2 border">Action</th>
                </tr>
              </thead>
              <tbody>
                {% for visitor in visitors_in %}
                <tr>
                  <td class="p-2 border">{{visitor.name}}</td>
                  <td class="p-2 border">{{visitor.visitor_id}}</td>
                  <td class="p-2 border">{{visitor.host.userauth}}</td>
                  <td class="p-2 border">{{visitor.reason}}</td>
                  <td class="p-2 border">{{visitor.check_in|date:"Y-m-d H:i"}}</td>
                  <td class="p-2 border">
                    <a href="{% url 'userauth:check_out' visitor.id %}" class="bg-gray-800 text-white px-3 py-1 rounded">Check Out</a>
                </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            </div>
            {% else %}
    <p class="text-gray-500">No visitors are currently checked in.</p>
  {% endif %}
          </section>
    
          <!-- Visitor Log and Host Directory -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Visitor Log -->
            <section class="bg-white p-6 rounded-lg shadow"><h3 class="text-xl font-semibold mb-4">Recent Visitors</h3>
<table class="table border">
    <thead>
        <tr>
            <th class="border p-2">Name</th>
            <th class="border p-2">Host</th>
            <th class="border p-2">Check In</th>
            <th class="border p-2">Check Out</th>
        </tr>
    </thead>
    <tbody>
        {% for visitor in logs %}
            <tr>
                <td class="border p-2">{{ visitor.name }}</td>
                <td class="border p-2">{{ visitor.host.username }}</td>
                <td class="border p-2">{{ visitor.check_in }}</td>
                <td class="border p-2">
                    {% if visitor.check_out %}
                        {{ visitor.check_out }}
                    {% else %}
                        <span class="text-red-500">Still inside</span>
                    {% endif %}
                </td>
            </tr>
        {% empty %}
            <tr><td colspan="6">No recent visitor records.</td></tr>
        {% endfor %}
    </tbody>
</table>

            </section>
    
            <!-- Host Directory -->
            <section class="bg-white p-6 rounded-lg shadow">
              <h2 class="text-xl font-semibold mb-4">Host Directory</h2>
              <label for="host-directory" class="sr-only">Host Directory</label>
              <select id="host-directory" class="border mb-4 w-full p-2 rounded" title="Host Directory">
                <option>All Hosts</option>
              </select>
              <ul class="space-y-2">
                <li class="border p-2 rounded">Alex Smith</li>
                <li class="border p-2 rounded">Sarah Lee</li>
                <li class="border p-2 rounded">David Wilson</li>
              </ul>
            </section>
          </div>

</section>
<script>
    // Get a reference to the div
    var myDiv = document.getElementById("notify");

    // Use setTimeout to hide the div after 2000 milliseconds (2 seconds)
    setTimeout(function () {
      myDiv.style.display = "none";
    }, 1000);
  </script>
{% endblock %}
