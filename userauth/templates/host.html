{% extends "base.html" %}
{% block content %}

<div class="container mx-auto px-6 py-8">
    <div class="flex flex-col md:flex-row">
        <!-- Sidebar -->
        <aside class="bg-gray-900 text-white w-full md:w-64 p-4 space-y-6 md:min-h-screen sticky top-0 z-10">
            <h1 class="text-xl md:text-2xl font-bold text-center md:text-left">HOST PERSONNEL</h1>
            <nav class="space-y-2">
                <a href="{% url 'userauth:profile' %}" class="block w-full px-4 py-2 bg-gray-800 rounded hover:bg-gray-700 text-center md:text-left">Profile</a>
                <button class="block w-full px-4 py-2 bg-gray-800 rounded hover:bg-gray-700 text-center md:text-left">Shift Logs</button>
                <button class="block w-full px-4 py-2 bg-red-700 rounded hover:bg-red-600 text-center md:text-left">Emergency Mode</button>
                <a href="{% url 'userauth:logout' %}" class="block w-full px-4 py-2 bg-gray-800 rounded hover:bg-gray-700 text-center md:text-left">Log Out</a>
            </nav>
          </aside>
          <div id="notifications" class="space-y-2"></div>
        <!-- Main Content -->
        <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 flex-1 mt-6 md:mt-0 md:ml-6">
            <!-- Visitors Today Card -->
            <div class="bg-white p-6 rounded-lg shadow-md" style="height: 300px;">
            <h2 class="text-xl font-semibold text-gray-700">Visitors Today</h2>
            <p class="text-2xl font-bold text-blue-600">{{ visitors_today }}</p>
            </div>

            <!-- Upcoming Visitors Card -->
            <div class="bg-white p-6 rounded-lg shadow-md" style="height: 300px;">
                <h2 class="text-xl font-semibold text-gray-700">Upcoming Visitors</h2>
                <ul class="mt-4 text-gray-600">
                    {% for visitor in upcoming_visitors %}
                        <li>{{ visitor.name }} - {{ visitor.expected_time }}</li>
                    {% empty %}
                        <li>No upcoming visitors.</li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Shift Information Card -->
            
        </section>
    </div>
</div>

<script>
    setTimeout(() => {
        const notify = document.getElementById("notify");
        if (notify) notify.style.display = "none";
    }, 2000);
</script>
<script>
    const userId = "{{ request.user.id }}";
    const socket = new WebSocket(`ws://${window.location.host}/ws/notifications/${userId}/`);

    socket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const message = data.message;
        const time = data.timestamp;

        const notificationArea = document.getElementById("notifications");
        const notificationHTML = `
            <div class="p-3 bg-green-100 border border-green-300 rounded-md">
                <strong class="text-green-800 block">${message}</strong>
                <small class="text-gray-600">${time}</small>
            </div>
        `;
        notificationArea.innerHTML = notificationHTML + notificationArea.innerHTML;
    };
</script>
{% endblock %}
